# Migration `20200807043859-initial-schema`

This migration has been generated by Ian Mitchell at 8/6/2020, 9:38:59 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."last_seen" (
"id" SERIAL,
"userId" text  NOT NULL ,
"lastSeen" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."karma" (
"id" SERIAL,
"guildId" text  NOT NULL ,
"userId" text  NOT NULL ,
"karma" integer  NOT NULL DEFAULT 0,
"lastUsage" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."replies" (
"id" SERIAL,
"guildId" text  NOT NULL ,
"trigger" text  NOT NULL ,
"response" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."linked_services" (
"id" SERIAL,
"userId" text  NOT NULL ,
"name" text  NOT NULL ,
"values" jsonb  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."settings" (
"id" SERIAL,
"key" text  NOT NULL ,
"value" jsonb  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."quotes" (
"id" SERIAL,
"guildId" text  NOT NULL ,
"quote" text  NOT NULL ,
"quoteId" integer  NOT NULL ,
"addedBy" text  NOT NULL ,
"channel" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."snapshots" (
"id" SERIAL,
"snapshot" jsonb  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."guild_settings" (
"id" SERIAL,
"guildId" text  NOT NULL ,
"mute" integer   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."enabled_commands" (
"id" SERIAL,
"guildSettingId" integer  NOT NULL ,
"name" text  NOT NULL ,
"enabled" boolean  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."command_configs" (
"id" SERIAL,
"commandId" integer  NOT NULL ,
"key" text  NOT NULL ,
"value" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."ignored_users" (
"id" SERIAL,
"guildSettingId" integer  NOT NULL ,
"userId" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."analytic_events" (
"id" SERIAL,
"action" text  NOT NULL ,
"category" text  NOT NULL ,
"label" text  NOT NULL ,
"context" jsonb  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."guild_bans" (
"id" SERIAL,
"guildId" text  NOT NULL ,
"reason" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "last_seen.userId_unique" ON "public"."last_seen"("userId")

CREATE  INDEX "last_seen.userId_index" ON "public"."last_seen"("userId")

CREATE UNIQUE INDEX "karma.guildId_userId_unique" ON "public"."karma"("guildId","userId")

CREATE  INDEX "karma.guildId_userId_index" ON "public"."karma"("guildId","userId")

CREATE  INDEX "replies.guildId_index" ON "public"."replies"("guildId")

CREATE UNIQUE INDEX "linked_services.userId_name_unique" ON "public"."linked_services"("userId","name")

CREATE  INDEX "linked_services.userId_name_index" ON "public"."linked_services"("userId","name")

CREATE UNIQUE INDEX "settings.key_unique" ON "public"."settings"("key")

CREATE  INDEX "settings.key_index" ON "public"."settings"("key")

CREATE UNIQUE INDEX "quotes.guildId_quoteId_unique" ON "public"."quotes"("guildId","quoteId")

CREATE  INDEX "quotes.guildId_index" ON "public"."quotes"("guildId")

CREATE UNIQUE INDEX "guild_settings.guildId_unique" ON "public"."guild_settings"("guildId")

CREATE  INDEX "guild_settings.guildId_index" ON "public"."guild_settings"("guildId")

CREATE UNIQUE INDEX "enabled_commands.guildSettingId_name_unique" ON "public"."enabled_commands"("guildSettingId","name")

CREATE UNIQUE INDEX "command_configs.commandId_key_unique" ON "public"."command_configs"("commandId","key")

CREATE UNIQUE INDEX "ignored_users.guildSettingId_userId_unique" ON "public"."ignored_users"("guildSettingId","userId")

CREATE  INDEX "analytic_events.action_index" ON "public"."analytic_events"("action")

CREATE UNIQUE INDEX "guild_bans.guildId_unique" ON "public"."guild_bans"("guildId")

CREATE  INDEX "guild_bans.guildId_index" ON "public"."guild_bans"("guildId")

ALTER TABLE "public"."enabled_commands" ADD FOREIGN KEY ("guildSettingId")REFERENCES "public"."guild_settings"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."command_configs" ADD FOREIGN KEY ("commandId")REFERENCES "public"."enabled_commands"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ignored_users" ADD FOREIGN KEY ("guildSettingId")REFERENCES "public"."guild_settings"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200807043859-initial-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,169 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model LastSeen {
+  id        Int      @default(autoincrement()) @id
+  userId    String   @unique
+  lastSeen  DateTime @default(now())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@index([userId])
+  @@map("last_seen")
+}
+
+model Karma {
+  id        Int      @default(autoincrement()) @id
+  guildId   String
+  userId    String
+  karma     Int      @default(0)
+  lastUsage DateTime @default(now())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@unique([guildId, userId])
+  @@index([guildId, userId])
+  @@map("karma")
+}
+
+model Reply {
+  id        Int      @default(autoincrement()) @id
+  guildId   String
+  trigger   String
+  response  String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@index([guildId])
+  @@map("replies")
+}
+
+model Service {
+  id        Int      @default(autoincrement()) @id
+  userId    String
+  name      String
+  values    Json
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@unique([userId, name])
+  @@index([userId, name])
+  @@map("linked_services")
+}
+
+model Setting {
+  id        Int      @default(autoincrement()) @id
+  key       String   @unique
+  value     Json
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@index([key])
+  @@map("settings")
+}
+
+model Quote {
+  id        Int      @default(autoincrement()) @id
+  guildId   String
+  quote     String
+  quoteId   Int
+  addedBy   String
+  channel   String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@unique([guildId, quoteId])
+  @@index(guildId)
+  @@map("quotes")
+}
+
+model Snapshot {
+  id        Int      @default(autoincrement()) @id
+  snapshot  Json
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@map("snapshots")
+}
+
+model GuildSetting {
+  id           Int              @default(autoincrement()) @id
+  guildId      String           @unique
+  mute         Int?
+  ignoredUsers IgnoredUser[]
+  createdAt    DateTime         @default(now())
+  updatedAt    DateTime         @updatedAt
+  commands     EnabledCommand[]
+
+  @@index([guildId])
+  @@map("guild_settings")
+}
+
+model EnabledCommand {
+  id             Int             @default(autoincrement()) @id
+  guildSetting   GuildSetting    @relation(fields: [guildSettingId], references: [id])
+  guildSettingId Int
+  name           String
+  enabled        Boolean
+  configs        CommandConfig[]
+  createdAt      DateTime        @default(now())
+  updatedAt      DateTime        @updatedAt
+
+  @@unique([guildSettingId, name])
+  @@map("enabled_commands")
+}
+
+model CommandConfig {
+  id        Int            @default(autoincrement()) @id
+  command   EnabledCommand @relation(fields: [commandId], references: [id])
+  commandId Int
+  key       String
+  value     String
+  createdAt DateTime       @default(now())
+  updatedAt DateTime       @updatedAt
+
+  @@unique([commandId, key])
+  @@map("command_configs")
+}
+
+model IgnoredUser {
+  id             Int          @default(autoincrement()) @id
+  guildSetting   GuildSetting @relation(fields: [guildSettingId], references: [id])
+  guildSettingId Int
+  userId         String
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+
+  @@unique([guildSettingId, userId])
+  @@map("ignored_users")
+}
+
+model Analytic {
+  id        Int      @default(autoincrement()) @id
+  action    String
+  category  String
+  label     String
+  context   Json
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@index([action])
+  @@map("analytic_events")
+}
+
+model BanList {
+  id        Int      @default(autoincrement()) @id
+  guildId   String   @unique
+  reason    String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@index([guildId])
+  @@map("guild_bans")
+}
```


