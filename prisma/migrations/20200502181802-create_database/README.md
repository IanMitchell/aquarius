# Migration `20200502181802-create_database`

This migration has been generated by Ian Mitchell at 5/2/2020, 6:18:02 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."LastSeen" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"lastSeen" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"updatedAt" timestamp(3)  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Karma" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"guildId" text  NOT NULL ,"id" SERIAL,"karma" integer  NOT NULL DEFAULT 0,"lastUsage" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"updatedAt" timestamp(3)  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Reply" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"guildId" text  NOT NULL ,"id" SERIAL,"response" text  NOT NULL ,"trigger" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Service" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"name" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Setting" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"key" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"value" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Quote" (
"addedBy" text  NOT NULL ,"channel" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"guildId" text  NOT NULL ,"id" SERIAL,"quote" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."GuildSnapshot" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."GuildSetting" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"guildId" text  NOT NULL ,"id" SERIAL,"mute" boolean  NOT NULL DEFAULT false,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Command" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"enabled" boolean  NOT NULL ,"guildSettingId" integer  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Config" (
"commandId" integer  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"key" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"value" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."IgnoredUser" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"guildSettingId" integer  NOT NULL ,"id" SERIAL,"updatedAt" timestamp(3)  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Analytic" (
"action" text  NOT NULL ,"category" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"label" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "LastSeen.userId" ON "public"."LastSeen"("userId")

CREATE UNIQUE INDEX "Karma.guildId_userId" ON "public"."Karma"("guildId","userId")

CREATE UNIQUE INDEX "Service.userId_name" ON "public"."Service"("userId","name")

CREATE UNIQUE INDEX "Setting.key" ON "public"."Setting"("key")

CREATE UNIQUE INDEX "GuildSetting.guildId" ON "public"."GuildSetting"("guildId")

CREATE UNIQUE INDEX "Command.guildSettingId_name" ON "public"."Command"("guildSettingId","name")

CREATE UNIQUE INDEX "Config.commandId_key" ON "public"."Config"("commandId","key")

CREATE UNIQUE INDEX "IgnoredUser.guildSettingId_userId" ON "public"."IgnoredUser"("guildSettingId","userId")

ALTER TABLE "public"."Command" ADD FOREIGN KEY ("guildSettingId")REFERENCES "public"."GuildSetting"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Config" ADD FOREIGN KEY ("commandId")REFERENCES "public"."Command"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."IgnoredUser" ADD FOREIGN KEY ("guildSettingId")REFERENCES "public"."GuildSetting"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200502181802-create_database
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,132 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model LastSeen {
+  id        Int      @default(autoincrement()) @id
+  userId    String   @unique
+  lastSeen  DateTime @default(now())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Karma {
+  id        Int      @default(autoincrement()) @id
+  guildId   String
+  karma     Int      @default(0)
+  lastUsage DateTime @default(now())
+  userId    String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@unique([guildId, userId])
+}
+
+model Reply {
+  id        Int      @default(autoincrement()) @id
+  guildId   String
+  trigger   String
+  response  String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Service {
+  id        Int      @default(autoincrement()) @id
+  userId    String
+  name      String
+  // TODO: JSON field
+  // values
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@unique([userId, name])
+}
+
+model Setting {
+  id        Int      @default(autoincrement()) @id
+  key       String   @unique
+  value     String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Quote {
+  id        Int      @default(autoincrement()) @id
+  guildId   String
+  quote     String
+  addedBy   String
+  channel   String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model GuildSnapshot {
+  id        Int      @default(autoincrement()) @id
+  // TODO: JSON field
+  // snapshot
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model GuildSetting {
+  id           Int           @default(autoincrement()) @id
+  guildId      String        @unique
+  mute         Boolean       @default(false)
+  ignoredUsers IgnoredUser[]
+  createdAt    DateTime      @default(now())
+  updatedAt    DateTime      @updatedAt
+  commands     Command[]
+}
+
+model Command {
+  id             Int          @default(autoincrement()) @id
+  guildSetting   GuildSetting @relation(fields: [guildSettingId], references: [id])
+  guildSettingId Int
+  name           String
+  enabled        Boolean
+  configs        Config[]
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+
+  @@unique([guildSettingId, name])
+}
+
+model Config {
+  id        Int      @default(autoincrement()) @id
+  command   Command  @relation(fields: [commandId], references: [id])
+  commandId Int
+  key       String
+  value     String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@unique([commandId, key])
+}
+
+model IgnoredUser {
+  id             Int          @default(autoincrement()) @id
+  guildSetting   GuildSetting @relation(fields: [guildSettingId], references: [id])
+  guildSettingId Int
+  userId         String
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+
+  @@unique([guildSettingId, userId])
+}
+
+model Analytic {
+  id        Int      @default(autoincrement()) @id
+  action    String
+  category  String
+  label     String
+  // TODO: JSON field
+  // context
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```


